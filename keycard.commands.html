<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>keycard.commands package &#8212; KeyCard.py  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="keycard.crypto package" href="keycard.crypto.html" />
    <link rel="prev" title="keycard package" href="keycard.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="keycard-commands-package">
<h1>keycard.commands package<a class="headerlink" href="#keycard-commands-package" title="Link to this heading">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading">¶</a></h2>
</section>
<section id="module-keycard.commands.ident">
<span id="keycard-commands-ident-module"></span><h2>keycard.commands.ident module<a class="headerlink" href="#module-keycard.commands.ident" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.ident.ident">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.ident.</span></span><span class="sig-name descname"><span class="pre">ident</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">challenge</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.ident.ident" title="Link to this definition">¶</a></dt>
<dd><p>Sends a challenge to the card to receive a signed identity response.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – An instance of the Transport class to communicate with
the card.</p></li>
<li><p><strong>challenge</strong> (<em>bytes</em>) – A challenge (nonce or data) to send to the card.
If None, a random 32-byte challenge is generated.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The public key extracted from the card’s identity response.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>bytes</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the response status word is not successful (0x9000).</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-keycard.commands.init">
<span id="keycard-commands-init-module"></span><h2>keycard.commands.init module<a class="headerlink" href="#module-keycard.commands.init" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.init.init">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.init.</span></span><span class="sig-name descname"><span class="pre">init</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">puk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pairing_secret</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.init.init" title="Link to this definition">¶</a></dt>
<dd><p>Initializes a Keycard device with PIN, PUK, and pairing secret.</p>
<p>Establishes an ephemeral ECDH key exchange and sends encrypted
credentials to the card.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – The transport used to send APDU commands to the card.</p></li>
<li><p><strong>card_public_key</strong> (<em>bytes</em>) – The card’s ECC public key, usually
retrieved via select().</p></li>
<li><p><strong>pin</strong> (<em>bytes</em>) – The personal identification number (PIN) as bytes.</p></li>
<li><p><strong>puk</strong> (<em>bytes</em>) – The personal unblocking key (PUK) as bytes.</p></li>
<li><p><strong>pairing_secret</strong> (<em>bytes</em>) – A 32-byte shared secret or a passphrase that
will be converted into one.</p></li>
</ul>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.NotSelectedError" title="keycard.exceptions.NotSelectedError"><strong>NotSelectedError</strong></a> – If no card public key is provided.</p></li>
<li><p><strong>ValueError</strong> – If the encrypted data exceeds a single APDU length.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a failure status word.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="keycard-commands-mutually-authenticate-module">
<h2>keycard.commands.mutually_authenticate module<a class="headerlink" href="#keycard-commands-mutually-authenticate-module" title="Link to this heading">¶</a></h2>
<dl class="py function" id="module-keycard.commands.mutually_authenticate">
<dt class="sig sig-object py" id="keycard.commands.mutually_authenticate.mutually_authenticate">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.mutually_authenticate.</span></span><span class="sig-name descname"><span class="pre">mutually_authenticate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">client_challenge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.mutually_authenticate.mutually_authenticate" title="Link to this definition">¶</a></dt>
<dd><p>Performs mutual authentication between the client and the Keycard.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
<dl class="simple">
<dt>Preconditions:</dt><dd><ul class="simple">
<li><p>Secure Channel must be opened</p></li>
</ul>
</dd>
</dl>
<p>The card will respond with a cryptographic challenge. The secure
session will verify the response. If the response is not exactly
32 bytes, or if the response has an unexpected status word, the
function raises an error.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transport</strong> – A Transport instance for sending APDUs.</p></li>
<li><p><strong>session</strong> – A SecureChannel instance used for wrapping/unwrapping.</p></li>
<li><p><strong>client_challenge</strong> (<em>bytes</em><em>, </em><em>optional</em>) – Optional challenge bytes.
If not provided, a random 32-byte value will be generated.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the response status word is not 0x9000.</p></li>
<li><p><strong>ValueError</strong> – If the decrypted response is not exactly 32 bytes.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="keycard-commands-open-secure-channel-module">
<h2>keycard.commands.open_secure_channel module<a class="headerlink" href="#keycard-commands-open-secure-channel-module" title="Link to this heading">¶</a></h2>
<dl class="py function" id="module-keycard.commands.open_secure_channel">
<dt class="sig sig-object py" id="keycard.commands.open_secure_channel.open_secure_channel">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.open_secure_channel.</span></span><span class="sig-name descname"><span class="pre">open_secure_channel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pairing_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pairing_key</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.open_secure_channel.open_secure_channel" title="Link to this definition">¶</a></dt>
<dd><p>Opens a secure session with the Keycard using ECDH and a pairing key.</p>
<p>This function performs an ephemeral ECDH key exchange with the card,
sends the ephemeral public key, and receives cryptographic material
from the card to derive a secure session.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecureChannel</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – The transport used to communicate with the card.</p></li>
<li><p><strong>card_public_key</strong> (<em>bytes</em>) – The ECC public key of the card, retrieved
via select().</p></li>
<li><p><strong>pairing_index</strong> (<em>int</em>) – The index of the previously established
pairing slot.</p></li>
<li><p><strong>pairing_key</strong> (<em>bytes</em>) – The shared 32-byte pairing key.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A newly established secure session with the card.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>SecureChannel</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.NotSelectedError" title="keycard.exceptions.NotSelectedError"><strong>NotSelectedError</strong></a> – If no card public key is provided.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a failure status word.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-keycard.commands.pair">
<span id="keycard-commands-pair-module"></span><h2>keycard.commands.pair module<a class="headerlink" href="#module-keycard.commands.pair" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.pair.pair">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.pair.</span></span><span class="sig-name descname"><span class="pre">pair</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_secret</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pairing_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">PairingMode.ANY</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.pair.pair" title="Link to this definition">¶</a></dt>
<dd><p>Performs an ECDH-based pairing handshake with the card.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code>]</span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>card</strong> – The keycard interface.</p></li>
<li><p><strong>shared_secret</strong> – A 32-byte secret or a passphrase convertible to one.</p></li>
<li><p><strong>pairing_mode</strong> – Mode for pairing: ANY, EPHEMERAL, PERSISTENT</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Pairing index and derived 32-byte pairing key.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tuple[int, bytes]</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If the shared secret is not 32 bytes.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a non-success status word.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.InvalidResponseError" title="keycard.exceptions.InvalidResponseError"><strong>InvalidResponseError</strong></a> – If response lengths or values are unexpected.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="keycard-commands-select-module">
<h2>keycard.commands.select module<a class="headerlink" href="#keycard-commands-select-module" title="Link to this heading">¶</a></h2>
<dl class="py function" id="module-keycard.commands.select">
<dt class="sig sig-object py" id="keycard.commands.select.select">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.select.</span></span><span class="sig-name descname"><span class="pre">select</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.select.select" title="Link to this definition">¶</a></dt>
<dd><p>Selects the Keycard application on the smart card and retrieves
application information.</p>
<p>Sends a SELECT APDU command using the Keycard AID, checks for a
successful response, parses the returned application information,
and returns it.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="keycard.parsing.html#keycard.parsing.application_info.ApplicationInfo" title="keycard.parsing.application_info.ApplicationInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ApplicationInfo</span></code></a></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>transport</strong> – The transport instance used to send the APDU command.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>Parsed information about the selected Keycard</dt><dd><p>application.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="keycard.parsing.html#keycard.parsing.application_info.ApplicationInfo" title="keycard.parsing.application_info.ApplicationInfo">ApplicationInfo</a></p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a status word indicating failure.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="keycard-commands-unpair-module">
<h2>keycard.commands.unpair module<a class="headerlink" href="#keycard-commands-unpair-module" title="Link to this heading">¶</a></h2>
<dl class="py function" id="module-keycard.commands.unpair">
<dt class="sig sig-object py" id="keycard.commands.unpair.unpair">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.unpair.</span></span><span class="sig-name descname"><span class="pre">unpair</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.unpair.unpair" title="Link to this definition">¶</a></dt>
<dd><p>Sends the UNPAIR command to remove a pairing index from the card.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
<dl class="simple">
<dt>Preconditions:</dt><dd><ul class="simple">
<li><p>Secure Channel must be opened</p></li>
<li><p>PIN must be verified</p></li>
</ul>
</dd>
</dl>
<p>This function securely communicates with the card using the established
session to instruct it to forget a specific pairing index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transport</strong> – The transport interface used to send APDUs.</p></li>
<li><p><strong>secure_session</strong> – The active SecureChannel object used to wrap APDUs.</p></li>
<li><p><strong>index</strong> (<em>int</em>) – The pairing index (0–15) to unpair from the card.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – If transport or secure_session is not provided, or if
    the session is not authenticated.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the response status word indicates an error.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="keycard-commands-verify-pin-module">
<h2>keycard.commands.verify_pin module<a class="headerlink" href="#keycard-commands-verify-pin-module" title="Link to this heading">¶</a></h2>
<dl class="py function" id="module-keycard.commands.verify_pin">
<dt class="sig sig-object py" id="keycard.commands.verify_pin.verify_pin">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.verify_pin.</span></span><span class="sig-name descname"><span class="pre">verify_pin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.verify_pin.verify_pin" title="Link to this definition">¶</a></dt>
<dd><p>Verifies the user PIN with the card using a secure session.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span></p>
</dd>
</dl>
<dl class="simple">
<dt>Preconditions:</dt><dd><ul class="simple">
<li><p>Secure Channel must be opened</p></li>
<li><p>PIN must be verified</p></li>
</ul>
</dd>
</dl>
<p>Sends the VERIFY PIN APDU command through the secure session. Returns
True if the PIN is correct, False if incorrect with remaining attempts,
and raises an error if blocked or another APDU error occurs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transport</strong> – The transport instance used to send the command.</p></li>
<li><p><strong>session</strong> – An established SecureChannel object.</p></li>
<li><p><strong>pin</strong> (<em>str</em>) – The PIN string to be verified.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the PIN is correct, False if incorrect but still allowed.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – If no secure session is provided.</p></li>
<li><p><strong>RuntimeError</strong> – If the PIN is blocked (no attempts remaining).</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – For other status word errors returned by the card.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-keycard.commands">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-keycard.commands" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.change_secret">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">change_secret</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin_type</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.change_secret" title="Link to this definition">¶</a></dt>
<dd><p>Changes the specified secret (PIN, PUK, PAIRING) or secret on the card.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
<dl class="simple">
<dt>Preconditions:</dt><dd><ul class="simple">
<li><p>Secure Channel must be opened</p></li>
<li><p>User PIN must be verified</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>card</strong> – The card session object.</p></li>
<li><p><strong>new_value</strong> (<em>bytes</em><em> | </em><em>str</em>) – The new PIN/PUK/secret.</p></li>
<li><p><strong>pin_type</strong> (<a class="reference internal" href="keycard.html#keycard.constants.PinType" title="keycard.constants.PinType"><em>PinType</em></a>) – Type of PIN (USER, PUK, or PAIRING)</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – If input format is invalid.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns an error status word.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.derive_key">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">derive_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.derive_key" title="Link to this definition">¶</a></dt>
<dd><p>Set the derivation path for subsequent SIGN and EXPORT KEY commands.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>card</strong> (<em>CardInterface</em>) – The card interface.</p></li>
<li><p><strong>path</strong> (<em>str</em>) – BIP-32-style path (e.g., “m/44’/60’/0’/0/0”) or
“../0/1” (parent) or “./0” (current).</p></li>
</ul>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – if the derivation fails or the format is invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.export_key">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">export_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">derivation_option</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">public_only</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keypath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">make_current</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">DerivationSource.MASTER</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.export_key" title="Link to this definition">¶</a></dt>
<dd><p>Export a key (public or private) from the card using an optional keypath.</p>
<p>If derivation_option == CURRENT, keypath can be omitted or empty.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExportedKey</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>card</strong> – The card object</p></li>
<li><p><strong>derivation_option</strong> – e.g. DERIVE, CURRENT, DERIVE_AND_MAKE_CURRENT</p></li>
<li><p><strong>public_only</strong> – If True, export only public key</p></li>
<li><p><strong>keypath</strong> – BIP32-style string or packed bytes, or None if CURRENT</p></li>
<li><p><strong>make_current</strong> – Whether to update the card’s current path</p></li>
<li><p><strong>source</strong> – MASTER (0x00), PARENT (0x40), CURRENT (0x80)</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict with optional ‘public_key’, ‘private_key’, ‘chain_code’</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.factory_reset">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">factory_reset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.factory_reset" title="Link to this definition">¶</a></dt>
<dd><p>Sends the FACTORY_RESET command to the card.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.generate_key">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">generate_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.generate_key" title="Link to this definition">¶</a></dt>
<dd><p>Generates a new key on the card and returns the key UID.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></span></p>
</dd>
</dl>
<dl class="simple">
<dt>Preconditions:</dt><dd><ul class="simple">
<li><p>Secure Channel must be opened</p></li>
<li><p>PIN must be verified</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transport</strong> – Transport instance for APDU communication</p></li>
<li><p><strong>session</strong> – SecureChannel instance for wrapping/unwrapping</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Key UID (SHA-256 of the public key)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bytes</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the response status word is not 0x9000</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.generate_mnemonic">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">generate_mnemonic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checksum_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.generate_mnemonic" title="Link to this definition">¶</a></dt>
<dd><p>Generate a BIP39 mnemonic using the card’s RNG.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>card</strong> (<em>CardInterface</em>) – The card interface.</p></li>
<li><p><strong>checksum_size</strong> (<em>int</em>) – Number of checksum bits
(between 4 and 8 inclusive).</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>List of integers (0-2047) corresponding to wordlist</dt><dd><p>indexes.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>List[int]</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If checksum size is outside the allowed range.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card rejects the request.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.get_data">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">get_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">StorageSlot.PUBLIC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.get_data" title="Link to this definition">¶</a></dt>
<dd><p>Gets the data on the card previously stored with the store data command
in the specified slot.</p>
<p>If the secure channel is open, it uses the secure APDU command.
Otherwise, it uses the proprietary APDU command.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>card</strong> – The card session object.</p></li>
<li><p><strong>slot</strong> (<a class="reference internal" href="keycard.html#keycard.constants.StorageSlot" title="keycard.constants.StorageSlot"><em>StorageSlot</em></a>) – Where to store the data (PUBLIC, NDEF, CASH)</p></li>
</ul>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If slot is invalid or data is too long.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.get_status">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">get_status</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.get_status" title="Link to this definition">¶</a></dt>
<dd><p>Query the application status or key path from the Keycard.</p>
<p>Requires an open Secure Channel.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code> | <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>] | <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – Transport instance used to send APDU bytes.</p></li>
<li><p><strong>session</strong> – An established SecureChannel instance.</p></li>
<li><p><strong>key_path</strong> (<em>bool</em>) – If True, returns the current key path.
If False (default), returns application status.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><blockquote>
<div><dl class="simple">
<dt>dict with keys:</dt><dd><ul class="simple">
<li><p>pin_retry_count (int)</p></li>
<li><p>puk_retry_count (int)</p></li>
<li><p>initialized (bool)</p></li>
</ul>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>If key_path is True:</dt><dd><p>List of 32-bit integers representing the current key path.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>If key_path is False</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the response status word is not 0x9000.</p></li>
<li><p><strong>ValueError</strong> – If the application status template (tag 0xA3) is missing.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.ident">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">ident</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">challenge</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.ident" title="Link to this definition">¶</a></dt>
<dd><p>Sends a challenge to the card to receive a signed identity response.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – An instance of the Transport class to communicate with
the card.</p></li>
<li><p><strong>challenge</strong> (<em>bytes</em>) – A challenge (nonce or data) to send to the card.
If None, a random 32-byte challenge is generated.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The public key extracted from the card’s identity response.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>bytes</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the response status word is not successful (0x9000).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.init">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">init</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">puk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pairing_secret</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.init" title="Link to this definition">¶</a></dt>
<dd><p>Initializes a Keycard device with PIN, PUK, and pairing secret.</p>
<p>Establishes an ephemeral ECDH key exchange and sends encrypted
credentials to the card.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – The transport used to send APDU commands to the card.</p></li>
<li><p><strong>card_public_key</strong> (<em>bytes</em>) – The card’s ECC public key, usually
retrieved via select().</p></li>
<li><p><strong>pin</strong> (<em>bytes</em>) – The personal identification number (PIN) as bytes.</p></li>
<li><p><strong>puk</strong> (<em>bytes</em>) – The personal unblocking key (PUK) as bytes.</p></li>
<li><p><strong>pairing_secret</strong> (<em>bytes</em>) – A 32-byte shared secret or a passphrase that
will be converted into one.</p></li>
</ul>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.NotSelectedError" title="keycard.exceptions.NotSelectedError"><strong>NotSelectedError</strong></a> – If no card public key is provided.</p></li>
<li><p><strong>ValueError</strong> – If the encrypted data exceeds a single APDU length.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a failure status word.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.load_key">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">load_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">public_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">private_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chain_code</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bip39_seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.load_key" title="Link to this definition">¶</a></dt>
<dd><p>Load a key into the card for signing purposes.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>card</strong> – The card interface.</p></li>
<li><p><strong>key_type</strong> – Key type</p></li>
<li><p><strong>public_key</strong> – Optional ECC public key (tag 0x80).</p></li>
<li><p><strong>private_key</strong> – ECC private key (tag 0x81).</p></li>
<li><p><strong>chain_code</strong> – Optional chain code (tag 0x82, only for extended key).</p></li>
<li><p><strong>bip39_seed</strong> – 64-byte BIP39 seed (only for key_type=BIP39_SEED).</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>UID of the loaded key (SHA-256 of public key).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.mutually_authenticate">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">mutually_authenticate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">client_challenge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.mutually_authenticate" title="Link to this definition">¶</a></dt>
<dd><p>Performs mutual authentication between the client and the Keycard.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
<dl class="simple">
<dt>Preconditions:</dt><dd><ul class="simple">
<li><p>Secure Channel must be opened</p></li>
</ul>
</dd>
</dl>
<p>The card will respond with a cryptographic challenge. The secure
session will verify the response. If the response is not exactly
32 bytes, or if the response has an unexpected status word, the
function raises an error.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transport</strong> – A Transport instance for sending APDUs.</p></li>
<li><p><strong>session</strong> – A SecureChannel instance used for wrapping/unwrapping.</p></li>
<li><p><strong>client_challenge</strong> (<em>bytes</em><em>, </em><em>optional</em>) – Optional challenge bytes.
If not provided, a random 32-byte value will be generated.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the response status word is not 0x9000.</p></li>
<li><p><strong>ValueError</strong> – If the decrypted response is not exactly 32 bytes.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.open_secure_channel">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">open_secure_channel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pairing_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pairing_key</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.open_secure_channel" title="Link to this definition">¶</a></dt>
<dd><p>Opens a secure session with the Keycard using ECDH and a pairing key.</p>
<p>This function performs an ephemeral ECDH key exchange with the card,
sends the ephemeral public key, and receives cryptographic material
from the card to derive a secure session.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecureChannel</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – The transport used to communicate with the card.</p></li>
<li><p><strong>card_public_key</strong> (<em>bytes</em>) – The ECC public key of the card, retrieved
via select().</p></li>
<li><p><strong>pairing_index</strong> (<em>int</em>) – The index of the previously established
pairing slot.</p></li>
<li><p><strong>pairing_key</strong> (<em>bytes</em>) – The shared 32-byte pairing key.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A newly established secure session with the card.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>SecureChannel</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.NotSelectedError" title="keycard.exceptions.NotSelectedError"><strong>NotSelectedError</strong></a> – If no card public key is provided.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a failure status word.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.pair">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">pair</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_secret</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pairing_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">PairingMode.ANY</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.pair" title="Link to this definition">¶</a></dt>
<dd><p>Performs an ECDH-based pairing handshake with the card.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code>]</span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>card</strong> – The keycard interface.</p></li>
<li><p><strong>shared_secret</strong> – A 32-byte secret or a passphrase convertible to one.</p></li>
<li><p><strong>pairing_mode</strong> – Mode for pairing: ANY, EPHEMERAL, PERSISTENT</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Pairing index and derived 32-byte pairing key.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tuple[int, bytes]</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If the shared secret is not 32 bytes.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a non-success status word.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.InvalidResponseError" title="keycard.exceptions.InvalidResponseError"><strong>InvalidResponseError</strong></a> – If response lengths or values are unexpected.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.remove_key">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">remove_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.remove_key" title="Link to this definition">¶</a></dt>
<dd><p>Removes the key from the card, returning it to an uninitialized state.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.select">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">select</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.select" title="Link to this definition">¶</a></dt>
<dd><p>Selects the Keycard application on the smart card and retrieves
application information.</p>
<p>Sends a SELECT APDU command using the Keycard AID, checks for a
successful response, parses the returned application information,
and returns it.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="keycard.parsing.html#keycard.parsing.application_info.ApplicationInfo" title="keycard.parsing.application_info.ApplicationInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ApplicationInfo</span></code></a></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>transport</strong> – The transport instance used to send the APDU command.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>Parsed information about the selected Keycard</dt><dd><p>application.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="keycard.parsing.html#keycard.parsing.application_info.ApplicationInfo" title="keycard.parsing.application_info.ApplicationInfo">ApplicationInfo</a></p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a status word indicating failure.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.set_pinless_path">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">set_pinless_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.set_pinless_path" title="Link to this definition">¶</a></dt>
<dd><p>Set a PIN-less path on the card. Allows signing without PIN/auth if the
current derived key matches this path.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>card</strong> (<em>CardInterface</em>) – The card interface.</p></li>
<li><p><strong>path</strong> (<em>str</em>) – BIP-32-style path (e.g., “m/44’/60’/0’/0/0”). An empty
string disables the pinless path.</p></li>
</ul>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – if the card rejects the input (invalid path)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.sign">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">sign</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">digest</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">DerivationOption.CURRENT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">SigningAlgorithm.ECDSA_SECP256K1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">derivation_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.sign" title="Link to this definition">¶</a></dt>
<dd><p>Sign a 32-byte digest using the specified key and signing algorithm.</p>
<p>This command sends the SIGN APDU to the Keycard and parses the response,
returning a structured <cite>SignatureResult</cite> object. The signature may be
returned as a DER-encoded structure, a raw 65-byte format including
the recovery ID, or an ECDSA template depending on card behavior.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">SignatureResult</span></code></span></p>
</dd>
</dl>
<dl class="simple">
<dt>Preconditions:</dt><dd><ul class="simple">
<li><p>Secure Channel must be opened (unless using PINLESS)</p></li>
<li><p>PIN must be verified (unless using PINLESS)</p></li>
<li><p>A valid keypair must be loaded on the card</p></li>
<li><p>If P1=PINLESS, a PIN-less path must be configured</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>card</strong> (<em>CardInterface</em>) – Active Keycard transport session.</p></li>
<li><p><strong>digest</strong> (<em>bytes</em>) – 32-byte hash to be signed.</p></li>
<li><p><strong>p1</strong> (<a class="reference internal" href="keycard.html#keycard.constants.DerivationOption" title="keycard.constants.DerivationOption"><em>DerivationOption</em></a>) – Key derivation option. One of:
- CURRENT: Sign with the currently loaded key
- DERIVE: Derive key for signing without changing current
- DERIVE_AND_MAKE_CURRENT: Derive and load for future use
- PINLESS: Use pre-defined PIN-less key without SC/PIN</p></li>
<li><p><strong>p2</strong> (<a class="reference internal" href="keycard.html#keycard.constants.SigningAlgorithm" title="keycard.constants.SigningAlgorithm"><em>SigningAlgorithm</em></a>) – Signing algorithm (e.g. ECDSA_SECP256K1).</p></li>
<li><p><strong>derivation_path</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) – String-formatted BIP32 path
(e.g. “m/44’/60’/0’/0/0”). Required if <cite>p1</cite> uses derivation.
The source (master/parent/current) is inferred from the path
prefix.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Parsed signature result, including the signature
(DER or raw), algorithm, and optional recovery ID or public key.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>SignatureResult</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – If the digest is not 32 bytes or path is invalid.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.InvalidStateError" title="keycard.exceptions.InvalidStateError"><strong>InvalidStateError</strong></a> – If preconditions (PIN, SC) are not met.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns an error (e.g., SW=0x6985).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.store_data">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">store_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">StorageSlot.PUBLIC</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.store_data" title="Link to this definition">¶</a></dt>
<dd><p>Stores data on the card in the specified slot.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>card</strong> – The card session object.</p></li>
<li><p><strong>data</strong> (<em>bytes</em>) – The data to store (max 127 bytes).</p></li>
<li><p><strong>slot</strong> (<a class="reference internal" href="keycard.html#keycard.constants.StorageSlot" title="keycard.constants.StorageSlot"><em>StorageSlot</em></a>) – Where to store the data (PUBLIC, NDEF, CASH)</p></li>
</ul>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If slot is invalid or data is too long.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.unblock_pin">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">unblock_pin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">puk_and_pin</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.unblock_pin" title="Link to this definition">¶</a></dt>
<dd><p>Unblocks the user PIN using the provided PUK and sets a new PIN.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>card</strong> – The card session object.</p></li>
<li><p><strong>puk_and_pin</strong> (<em>bytes</em><em> | </em><em>str</em>) – Concatenation of PUK (12 digits) + new PIN
(6 digits)</p></li>
</ul>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If the format is invalid.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns an error.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.unpair">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">unpair</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.unpair" title="Link to this definition">¶</a></dt>
<dd><p>Sends the UNPAIR command to remove a pairing index from the card.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
<dl class="simple">
<dt>Preconditions:</dt><dd><ul class="simple">
<li><p>Secure Channel must be opened</p></li>
<li><p>PIN must be verified</p></li>
</ul>
</dd>
</dl>
<p>This function securely communicates with the card using the established
session to instruct it to forget a specific pairing index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transport</strong> – The transport interface used to send APDUs.</p></li>
<li><p><strong>secure_session</strong> – The active SecureChannel object used to wrap APDUs.</p></li>
<li><p><strong>index</strong> (<em>int</em>) – The pairing index (0–15) to unpair from the card.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – If transport or secure_session is not provided, or if
    the session is not authenticated.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the response status word indicates an error.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.verify_pin">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.</span></span><span class="sig-name descname"><span class="pre">verify_pin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">card</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.verify_pin" title="Link to this definition">¶</a></dt>
<dd><p>Verifies the user PIN with the card using a secure session.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span></p>
</dd>
</dl>
<dl class="simple">
<dt>Preconditions:</dt><dd><ul class="simple">
<li><p>Secure Channel must be opened</p></li>
<li><p>PIN must be verified</p></li>
</ul>
</dd>
</dl>
<p>Sends the VERIFY PIN APDU command through the secure session. Returns
True if the PIN is correct, False if incorrect with remaining attempts,
and raises an error if blocked or another APDU error occurs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transport</strong> – The transport instance used to send the command.</p></li>
<li><p><strong>session</strong> – An established SecureChannel object.</p></li>
<li><p><strong>pin</strong> (<em>str</em>) – The PIN string to be verified.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the PIN is correct, False if incorrect but still allowed.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – If no secure session is provided.</p></li>
<li><p><strong>RuntimeError</strong> – If the PIN is blocked (no attempts remaining).</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – For other status word errors returned by the card.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">KeyCard.py</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">keycard</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="keycard.html">keycard package</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="modules.html">keycard</a><ul>
  <li><a href="keycard.html">keycard package</a><ul>
      <li>Previous: <a href="keycard.html" title="previous chapter">keycard package</a></li>
      <li>Next: <a href="keycard.crypto.html" title="next chapter">keycard.crypto package</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, mmlado.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.0.4</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/keycard.commands.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>