<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>keycard.commands package &#8212; KeyCard.py  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="keycard.crypto package" href="keycard.crypto.html" />
    <link rel="prev" title="keycard package" href="keycard.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="keycard-commands-package">
<h1>keycard.commands package<a class="headerlink" href="#keycard-commands-package" title="Link to this heading">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading">¶</a></h2>
</section>
<section id="module-keycard.commands.ident">
<span id="keycard-commands-ident-module"></span><h2>keycard.commands.ident module<a class="headerlink" href="#module-keycard.commands.ident" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.ident.ident">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.ident.</span></span><span class="sig-name descname"><span class="pre">ident</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transport</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">challenge</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.ident.ident" title="Link to this definition">¶</a></dt>
<dd><p>Sends a challenge to the card to receive a signed identity response.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="keycard.parsing.html#keycard.parsing.identity.Identity" title="keycard.parsing.identity.Identity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Identity</span></code></a></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – An instance of the Transport class to communicate with
the card.</p></li>
<li><p><strong>challenge</strong> (<em>bytes</em>) – A challenge (nonce or data) to send to the card.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A parsed identity object containing the card’s response.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="keycard.parsing.html#keycard.parsing.identity.Identity" title="keycard.parsing.identity.Identity">Identity</a></p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the response status word is not successful (0x9000).</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-keycard.commands.init">
<span id="keycard-commands-init-module"></span><h2>keycard.commands.init module<a class="headerlink" href="#module-keycard.commands.init" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.init.init">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.init.</span></span><span class="sig-name descname"><span class="pre">init</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transport</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">card_public_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">puk</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pairing_secret</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.init.init" title="Link to this definition">¶</a></dt>
<dd><p>Initializes a Keycard device with PIN, PUK, and pairing secret.</p>
<p>Establishes an ephemeral ECDH key exchange and sends encrypted
credentials to the card.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – The transport used to send APDU commands to the card.</p></li>
<li><p><strong>card_public_key</strong> (<em>bytes</em>) – The card’s ECC public key, usually
retrieved via select().</p></li>
<li><p><strong>pin</strong> (<em>bytes</em>) – The personal identification number (PIN) as bytes.</p></li>
<li><p><strong>puk</strong> (<em>bytes</em>) – The personal unblocking key (PUK) as bytes.</p></li>
<li><p><strong>pairing_secret</strong> (<em>bytes</em>) – A 32-byte shared secret or a passphrase that
will be converted into one.</p></li>
</ul>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.NotSelectedError" title="keycard.exceptions.NotSelectedError"><strong>NotSelectedError</strong></a> – If no card public key is provided.</p></li>
<li><p><strong>ValueError</strong> – If the encrypted data exceeds a single APDU length.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a failure status word.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="keycard-commands-mutually-authenticate-module">
<h2>keycard.commands.mutually_authenticate module<a class="headerlink" href="#keycard-commands-mutually-authenticate-module" title="Link to this heading">¶</a></h2>
<dl class="py function" id="module-keycard.commands.mutually_authenticate">
<dt class="sig sig-object py" id="keycard.commands.mutually_authenticate.mutually_authenticate">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.mutually_authenticate.</span></span><span class="sig-name descname"><span class="pre">mutually_authenticate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transport</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">client_challenge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.mutually_authenticate.mutually_authenticate" title="Link to this definition">¶</a></dt>
<dd><p>Performs mutual authentication between the client and the Keycard.</p>
<p>The card will respond with a cryptographic challenge. The secure
session will verify the response. If the response is not exactly
32 bytes, or if the response has an unexpected status word, the
function raises an error.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – A Transport instance for sending APDUs.</p></li>
<li><p><strong>session</strong> – A SecureSession instance used for wrapping/unwrapping.</p></li>
<li><p><strong>client_challenge</strong> (<em>bytes</em><em>, </em><em>optional</em>) – Optional challenge bytes.
If not provided, a random 32-byte value will be generated.</p></li>
</ul>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the response status word is not 0x9000.</p></li>
<li><p><strong>ValueError</strong> – If the decrypted response is not exactly 32 bytes.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="keycard-commands-open-secure-channel-module">
<h2>keycard.commands.open_secure_channel module<a class="headerlink" href="#keycard-commands-open-secure-channel-module" title="Link to this heading">¶</a></h2>
<dl class="py function" id="module-keycard.commands.open_secure_channel">
<dt class="sig sig-object py" id="keycard.commands.open_secure_channel.open_secure_channel">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.open_secure_channel.</span></span><span class="sig-name descname"><span class="pre">open_secure_channel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transport</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">card_public_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pairing_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pairing_key</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.open_secure_channel.open_secure_channel" title="Link to this definition">¶</a></dt>
<dd><p>Opens a secure session with the Keycard using ECDH and a pairing key.</p>
<p>This function performs an ephemeral ECDH key exchange with the card,
sends the ephemeral public key, and receives cryptographic material
from the card to derive a secure session.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecureSession</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – The transport used to communicate with the card.</p></li>
<li><p><strong>card_public_key</strong> (<em>bytes</em>) – The ECC public key of the card, retrieved
via select().</p></li>
<li><p><strong>pairing_index</strong> (<em>int</em>) – The index of the previously established
pairing slot.</p></li>
<li><p><strong>pairing_key</strong> (<em>bytes</em>) – The shared 32-byte pairing key.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A newly established secure session with the card.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>SecureSession</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.NotSelectedError" title="keycard.exceptions.NotSelectedError"><strong>NotSelectedError</strong></a> – If no card public key is provided.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a failure status word.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-keycard.commands.pair">
<span id="keycard-commands-pair-module"></span><h2>keycard.commands.pair module<a class="headerlink" href="#module-keycard.commands.pair" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="keycard.commands.pair.pair">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.pair.</span></span><span class="sig-name descname"><span class="pre">pair</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transport</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shared_secret</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.pair.pair" title="Link to this definition">¶</a></dt>
<dd><p>Performs an ECDH-based pairing handshake with the card.</p>
<p>This function initiates a mutual challenge-response authentication and
derives a secure pairing key.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code>]</span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – A transport instance used to send APDU commands.</p></li>
<li><p><strong>shared_secret</strong> (<em>bytes</em>) – A 32-byte ECDH-derived secret or a passphrase
convertible to one.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The pairing index (0–15) and a derived 32-byte
pairing key.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tuple[int, bytes]</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If the shared secret is not 32 bytes.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a non-success status word.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.InvalidResponseError" title="keycard.exceptions.InvalidResponseError"><strong>InvalidResponseError</strong></a> – If response lengths or values are unexpected.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="keycard-commands-select-module">
<h2>keycard.commands.select module<a class="headerlink" href="#keycard-commands-select-module" title="Link to this heading">¶</a></h2>
<dl class="py function" id="module-keycard.commands.select">
<dt class="sig sig-object py" id="keycard.commands.select.select">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.select.</span></span><span class="sig-name descname"><span class="pre">select</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transport</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.select.select" title="Link to this definition">¶</a></dt>
<dd><p>Selects the Keycard application on the smart card and retrieves
application information.</p>
<p>Sends a SELECT APDU command using the Keycard AID, checks for a
successful response, parses the returned application information,
and returns it.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="keycard.parsing.html#keycard.parsing.application_info.ApplicationInfo" title="keycard.parsing.application_info.ApplicationInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">ApplicationInfo</span></code></a></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>transport</strong> – The transport instance used to send the APDU command.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>Parsed information about the selected Keycard</dt><dd><p>application.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="keycard.parsing.html#keycard.parsing.application_info.ApplicationInfo" title="keycard.parsing.application_info.ApplicationInfo">ApplicationInfo</a></p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the card returns a status word indicating failure.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="keycard-commands-unpair-module">
<h2>keycard.commands.unpair module<a class="headerlink" href="#keycard-commands-unpair-module" title="Link to this heading">¶</a></h2>
<dl class="py function" id="module-keycard.commands.unpair">
<dt class="sig sig-object py" id="keycard.commands.unpair.unpair">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.unpair.</span></span><span class="sig-name descname"><span class="pre">unpair</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transport</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">secure_session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.unpair.unpair" title="Link to this definition">¶</a></dt>
<dd><p>Sends the UNPAIR command to remove a pairing index from the card.</p>
<p>This function securely communicates with the card using the established
session to instruct it to forget a specific pairing index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>transport</strong> – The transport interface used to send APDUs.</p></li>
<li><p><strong>secure_session</strong> – The active SecureSession object used to wrap APDUs.</p></li>
<li><p><strong>index</strong> (<em>int</em>) – The pairing index (0–15) to unpair from the card.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError</strong> – If transport or secure_session is not provided, or if
    the session is not authenticated.</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – If the response status word indicates an error.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="keycard-commands-verify-pin-module">
<h2>keycard.commands.verify_pin module<a class="headerlink" href="#keycard-commands-verify-pin-module" title="Link to this heading">¶</a></h2>
<dl class="py function" id="module-keycard.commands.verify_pin">
<dt class="sig sig-object py" id="keycard.commands.verify_pin.verify_pin">
<span class="sig-prename descclassname"><span class="pre">keycard.commands.verify_pin.</span></span><span class="sig-name descname"><span class="pre">verify_pin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transport</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">session</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#keycard.commands.verify_pin.verify_pin" title="Link to this definition">¶</a></dt>
<dd><p>Verifies the user PIN with the card using a secure session.</p>
<p>Sends the VERIFY PIN APDU command through the secure session. Returns
True if the PIN is correct, False if incorrect with remaining attempts,
and raises an error if blocked or another APDU error occurs.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span></p>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>transport</strong> – The transport instance used to send the command.</p></li>
<li><p><strong>session</strong> – An established SecureSession object.</p></li>
<li><p><strong>pin</strong> (<em>str</em>) – The PIN string to be verified.</p></li>
</ul>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if the PIN is correct, False if incorrect but still allowed.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>bool</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If no secure session is provided.</p></li>
<li><p><strong>RuntimeError</strong> – If the PIN is blocked (no attempts remaining).</p></li>
<li><p><a class="reference internal" href="keycard.html#keycard.exceptions.APDUError" title="keycard.exceptions.APDUError"><strong>APDUError</strong></a> – For other status word errors returned by the card.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-keycard.commands">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-keycard.commands" title="Link to this heading">¶</a></h2>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">KeyCard.py</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">keycard</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="keycard.html">keycard package</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="modules.html">keycard</a><ul>
  <li><a href="keycard.html">keycard package</a><ul>
      <li>Previous: <a href="keycard.html" title="previous chapter">keycard package</a></li>
      <li>Next: <a href="keycard.crypto.html" title="next chapter">keycard.crypto package</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, mmlado.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/keycard.commands.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>